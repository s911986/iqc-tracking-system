<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTV æµç¨‹è¿½è¹¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .timeline-section {
            background: white;
            border-radius: 1rem;
            padding: 13rem 4rem 8rem;
            margin: 2rem 0;
            min-height: 900px;
        }
        
        .timeline-wrapper {
            position: relative;
            padding: 13rem 0 12rem;
        }
        
        .timeline-container {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 6rem;
        }
        
        /* é€£æ¥ç·š */
        .connecting-line {
            position: absolute;
            top: 50%;
            left: 3%;
            right: 3%;
            height: 6px;
            background: #e5e7eb;
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .progress-line {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 50%, #8b5cf6 100%);
            transition: width 0.5s ease;
            border-radius: 999px;
        }
        
        /* éšæ®µç¯€é» */
        .stage-node {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
            z-index: 10;
        }
        
        /* å®Œæˆæ™‚é–“ */
        .completion-time {
            position: absolute;
            top: -140px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.875rem;
            background: white;
            border: 1.5px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.688rem;
            color: #6b7280;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        
        .completion-time i {
            width: 12px;
            height: 12px;
        }
        
        .time-value {
            font-family: 'SF Mono', monospace;
            color: #1f2937;
            font-weight: 500;
            font-size: 0.688rem;
        }
        
        /* éšæ®µæ¨™é¡Œ */
        .stage-header {
            position: absolute;
            top: -75px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            white-space: nowrap;
        }
        
        .stage-icon {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
            transition: color 0.3s;
        }
        
        .stage-title {
            font-size: 1.25rem;
            font-weight: 700;
            transition: color 0.3s;
        }
        
        /* å·²å®Œæˆæˆ–é€²è¡Œä¸­çš„æ¨£å¼ï¼ˆé»‘è‰²ï¼‰ */
        .stage-node.completed .stage-icon,
        .stage-node.active .stage-icon {
            color: #6366f1;
        }
        
        .stage-node.completed .stage-title,
        .stage-node.active .stage-title {
            color: #1f2937;
        }
        
        /* å¾…è™•ç†çš„æ¨£å¼ï¼ˆç°è‰²ï¼‰ */
        .stage-node.pending .stage-icon {
            color: #9ca3af;
        }
        
        .stage-node.pending .stage-title {
            color: #9ca3af;
        }
        
        /* åœ“é» */
        .stage-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        
        .dot-completed {
            background: #3b82f6;
        }
        
        .dot-active {
            background: #10b981;
            width: 33px;
            height: 33px;
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .dot-pending {
            background: #d1d5db;
        }
        
        @keyframes pulse-ring {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
            }
            50% {
                box-shadow: 0 0 0 16px rgba(16, 185, 129, 0);
            }
        }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.625rem 1.5rem;
            border-radius: 9999px;
            font-size: 1rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .badge-completed {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-pending {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        /* å‹•ä½œå€åŸŸ */
        .action-area {
            position: absolute;
            top: 130px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.875rem;
        }
        
        .complete-button {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.35);
            white-space: nowrap;
        }
        
        .complete-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
        }
        
        /* è·¯ç·šé¸æ“‡ */
        .route-selection {
            display: flex;
            gap: 1.25rem;
        }
        
        .route-option {
            padding: 1.5rem 2rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.875rem;
            background: white;
        }
        
        .route-option:hover {
            border-color: #6366f1;
            background: #f5f3ff;
            transform: translateY(-3px);
        }
        
        .route-option i {
            width: 40px;
            height: 40px;
        }
        
        .route-option span {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        /* è¼¸å…¥æ¡† */
        .tracking-input {
            width: 260px;
            padding: 0.875rem 1.25rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
        }
        
        .tracking-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        /* å¿«éå–®è™Ÿé¡¯ç¤º */
        .tracking-display {
            padding: 0.75rem 1.25rem;
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 0.75rem;
            font-size: 1rem;
            color: #166534;
            font-family: 'SF Mono', monospace;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="max-w-[2000px] mx-auto p-8">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-8 bg-gradient-to-r from-indigo-500 to-purple-600 p-8 rounded-2xl shadow-lg text-white">
            <button onclick="window.location.href='index.html'" class="flex items-center gap-3 px-6 py-3 bg-white/20 hover:bg-white/30 rounded-xl transition text-lg">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
                <span id="back*`
î€€
cd ~/Desktop/iqc-tracking-system

cat > rtv-detail-no-route-time.js << 'JSEOF'
let currentRecord = null;
let recordId = null;
let currentStage = 0;
let selectedRoute = null;

const stages = {
    1: { icon: 'rocket', title: 'Kick Off' },
    2: { icon: 'package-open', title: 'å·²é›¢å» ' },
    3: { icon: 'git-branch', title: 'é¸æ“‡é‹é€æ–¹å¼', titleExpress: 'å¿«é', titleReturn: 'é€€é‹', isRoute: true },
    '4a': { icon: 'truck', title: 'å¿«éå–®è™Ÿ', needsInput: true, route: 'express' },
    '5a': { icon: 'map-pin', title: 'å·²æŠµé”å» å•†ç«¯', route: 'express' },
    '4b': { icon: 'map-pin', title: 'å·²æŠµé”å» å•†ç«¯', route: 'return' },
    6: { icon: 'microscope', title: 'FAé€²è¡Œä¸­' },
    7: { icon: 'check-circle', title: 'FAå·²å®Œæˆ' }
};

function formatDateTime(isoString) {
    const date = new Date(isoString);
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    const h = String(date.getHours()).padStart(2, '0');
    const min = String(date.getMinutes()).padStart(2, '0');
    const s = String(date.getSeconds()).padStart(2, '0');
    return `${y}-${m}-${d} ${h}:${min}:${s}`;
}

function formatDateTimeForInput(isoString) {
    const date = new Date(isoString);
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    const h = String(date.getHours()).padStart(2, '0');
    const min = String(date.getMinutes()).padStart(2, '0');
    return `${y}-${m}-${d}T${h}:${min}`;
}

function getCurrentDateTime() {
    return formatDateTimeForInput(new Date().toISOString());
}

document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    recordId = urlParams.get('id');
    if (!recordId) {
        alert('éŒ¯èª¤ï¼šæœªæŒ‡å®šè¨˜éŒ„ IDï¼');
        window.location.href = 'index.html';
        return;
    }
    loadRecord();
    renderAllStages();
    lucide.createIcons();
});

function loadRecord() {
    const storedRecords = localStorage.getItem('iqcRecords');
    if (!storedRecords) {
        window.location.href = 'index.html';
        return;
    }
    const records = JSON.parse(storedRecords);
    currentRecord = records.find(r => r.id === parseInt(recordId));
    if (!currentRecord) {
        window.location.href = 'index.html';
        return;
    }
    if (!currentRecord.rtv_data) {
        currentRecord.rtv_data = {
            current_stage: 0,
            selected_route: null,
            tracking_number: '',
            stage_completion: {},
            completion_dates: {}
        };
    }
    currentStage = currentRecord.rtv_data.current_stage || 0;
    selectedRoute = currentRecord.rtv_data.selected_route || null;
    
    document.getElementById('display-qpn').textContent = currentRecord.qpn || '-';
    document.getElementById('display-sn').textContent = currentRecord.sn || '-';
    document.getElementById('display-dept').textContent = currentRecord.dept || '-';
}

function renderAllStages() {
    const container = document.getElementById('timeline-container');
    const line = container.querySelector('.connecting-line');
    container.innerHTML = '';
    if (line) container.appendChild(line);
    
    let allStages = [1, 2, 3];
    
    if (selectedRoute === 'express') {
        allStages = [1, 2, 3, '4a', '5a', 6, 7];
    } else if (selectedRoute === 'return') {
        allStages = [1, 2, 3, '4b', 6, 7];
    } else {
        allStages = [1, 2, 3, '4a', '5a', 6, 7];
    }
    
    allStages.forEach(stageId => {
        if (selectedRoute) {
            const stage = stages[stageId];
            if (stage.route && stage.route !== selectedRoute) {
                return;
            }
        }
        
        const stageNode = createStageElement(stageId);
        container.appendChild(stageNode);
    });
    
    updateProgress();
    lucide.createIcons();
}

function createStageElement(stageId) {
    const stage = stages[stageId];
    const stageKey = 'stage' + stageId;
    const isCompleted = currentRecord.rtv_data.stage_completion[stageKey];
    const isActive = shouldBeActive(stageId);
    const completionDate = currentRecord.rtv_data.completion_dates[stageKey];
    
    let statusClass = 'pending';
    if (isCompleted) {
        statusClass = 'completed';
    } else if (isActive) {
        statusClass = 'active';
    }
    
    if (!selectedRoute && stage.route) {
        const div = document.createElement('div');
        div.className = 'stage-node pending';
        div.innerHTML = `
            <div class="stage-header">
                <i data-lucide="${stage.icon}" class="stage-icon"></i>
                <span class="stage-title">${stage.title}</span>
            </div>
            <div class="stage-dot dot-pending"></div>
            <span class="status-badge badge-pending">å¾…è™•ç†</span>
        `;
        return div;
    }
    
    const stageDiv = document.createElement('div');
    stageDiv.className = `stage-node ${statusClass}`;
    
    let html = '';
    
    // å®Œæˆæ™‚é–“ - ä½†è·¯ç·šé¸æ“‡éšæ®µä¸é¡¯ç¤º
    if (completionDate && !stage.isRoute) {
        html += `
            <div class="completion-time">
                <i data-lucide="clock"></i>
                <span>å®Œæˆæ™‚é–“</span>
                <span class="time-value">${formatDateTime(completionDate)}</span>
            </div>
        `;
    }
    
    // éšæ®µæ¨™é¡Œ
    let displayTitle = stage.title;
    if (stageId === 3 && selectedRoute) {
        displayTitle = selectedRoute === 'express' ? stage.titleExpress : stage.titleReturn;
    }
    
    html += `
        <div class="stage-header">
            <i data-lucide="${stage.icon}" class="stage-icon"></i>
            <span class="stage-title">${displayTitle}</span>
        </div>
    `;
    
    // åœ“é»
    html += `
        <div class="stage-dot ${isCompleted ? 'dot-completed' : isActive ? 'dot-active' : 'dot-pending'}"></div>
    `;
    
    // ç‹€æ…‹æ¨™ç±¤
    html += `
        <span class="status-badge ${isCompleted ? 'badge-completed' : isActive ? 'badge-active' : 'badge-pending'}">
            ${isCompleted ? 'å·²å®Œæˆ' : isActive ? 'é€²è¡Œä¸­' : 'å¾…è™•ç†'}
        </span>
    `;
    
    // å‹•ä½œå€åŸŸ
    html += '<div class="action-area">';
    
    // é¡¯ç¤ºå¿«éå–®è™Ÿ
    if (stageId === '4a' && isCompleted && currentRecord.rtv_data.tracking_number) {
        html += `
            <div class="tracking-display">
                å¿«éå–®è™Ÿ: ${currentRecord.rtv_data.tracking_number}
            </div>
        `;
    }
    
    // è·¯ç·šé¸æ“‡ï¼ˆç‰¹æ®Šè™•ç†ï¼Œä¸éœ€è¦å®Œæˆæ™‚é–“ï¼‰
    if (stage.isRoute && !selectedRoute && isActive) {
        html += `
            <div class="route-selection">
                <button class="route-option" onclick="selectRoute('express')">
                    <i data-lucide="truck" style="color: #6366f1;"></i>
                    <span>å¿«é</span>
                </button>
                <button class="route-option" onclick="selectRoute('return')">
                    <i data-lucide="package-x" style="color: #f97316;"></i>
                    <span>é€€é‹</span>
                </button>
            </div>
        `;
    }
    
    // æ™®é€šéšæ®µï¼šé¡¯ç¤ºå®Œæˆæ™‚é–“è¼¸å…¥æ¡†å’Œå…¶ä»–è¼¸å…¥
    if (isActive && !stage.isRoute && !isCompleted) {
        // å®Œæˆæ™‚é–“è¼¸å…¥æ¡†
        html += `
            <div style="margin-bottom: 0.75rem;">
                <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">
                    å®Œæˆæ™‚é–“
                </label>
                <input type="datetime-local" id="completion-time-${stageId}" class="tracking-input" 
                       value="${getCurrentDateTime()}" 
                       style="width: 260px;">
            </div>
        `;
        
        // å¿«éå–®è™Ÿè¼¸å…¥æ¡†
        if (stage.needsInput) {
            html += `
                <div style="margin-bottom: 0.75rem;">
                    <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">
                        å¿«éå–®è™Ÿ
                    </label>
                    <input type="text" id="tracking-number" class="tracking-input" 
                           placeholder="è¼¸å…¥å¿«éå–®è™Ÿ" 
                           value="${currentRecord.rtv_data.tracking_number || ''}"
                           style="width: 260px;">
                </div>
            `;
        }
        
        // å®ŒæˆæŒ‰éˆ•
        html += `
            <button class="complete-button" onclick="completeStage(${typeof stageId === 'string' ? "'" + stageId + "'" : stageId})">
                å®Œæˆæ­¤éšæ®µ
            </button>
        `;
    }
    
    html += '</div>';
    
    stageDiv.innerHTML = html;
    return stageDiv;
}

function shouldBeActive(stageId) {
    const stageKey = 'stage' + stageId;
    if (currentRecord.rtv_data.stage_completion[stageKey]) return false;
    
    if (typeof stageId === 'number' && currentStage === stageId - 1) return true;
    if (stageId === 3 && currentStage === 2) return true;
    if (stageId === '4a' && currentStage === 3 && selectedRoute === 'express') return true;
    if (stageId === '4b' && currentStage === 3 && selectedRoute === 'return') return true;
    if (stageId === '5a' && currentStage === 4 && selectedRoute === 'express') return true;
    if (stageId === 6) {
        if (selectedRoute === 'express' && currentStage === 5) return true;
        if (selectedRoute === 'return' && currentStage === 4) return true;
    }
    if (stageId === 7 && currentStage === 6) return true;
    
    return false;
}

function updateProgress() {
    const completion = currentRecord.rtv_data.stage_completion;
    let total = selectedRoute === 'express' ? 7 : selectedRoute === 'return' ? 6 : 3;
    const completed = Object.values(completion).filter(v => v).length;
    const percent = Math.round((completed / total) * 100);
    
    document.getElementById('progress-percentage').textContent = percent + '%';
    document.getElementById('progress-line').style.width = percent + '%';
}

window.completeStage = function(stage) {
    const stageInfo = stages[stage];
    
    // è·¯ç·šé¸æ“‡éšæ®µä¸æ‡‰è©²è¢«ç›´æ¥èª¿ç”¨
    if (stageInfo.isRoute && !selectedRoute) {
        alert('âš ï¸ è«‹å…ˆé¸æ“‡é‹é€æ–¹å¼ï¼');
        return;
    }
    
    // ç²å–ç”¨æˆ¶è¼¸å…¥çš„å®Œæˆæ™‚é–“
    const completionTimeInput = document.getElementById('completion-time-' + stage);
    if (!completionTimeInput) {
        alert('âš ï¸ æ‰¾ä¸åˆ°å®Œæˆæ™‚é–“è¼¸å…¥æ¡†ï¼');
        return;
    }
    
    const completionTimeValue = completionTimeInput.value;
    if (!completionTimeValue) {
        alert('âš ï¸ è«‹é¸æ“‡å®Œæˆæ™‚é–“ï¼');
        return;
    }
    
    // è½‰æ›ç‚º ISO æ ¼å¼
    const completionDate = new Date(completionTimeValue).toISOString();
    
    // å¿«éå–®è™Ÿæª¢æŸ¥
    if (stage === '4a') {
        const trackingNumber = document.getElementById('tracking-number').value.trim();
        if (!trackingNumber) {
            alert('âš ï¸ è«‹è¼¸å…¥å¿«éå–®è™Ÿï¼');
            return;
        }
        currentRecord.rtv_data.tracking_number = trackingNumber;
    }
    
    const stageKey = 'stage' + stage;
    currentRecord.rtv_data.stage_completion[stageKey] = true;
    currentRecord.rtv_data.completion_dates[stageKey] = completionDate;
    
    if (stage === 1) currentStage = 1;
    else if (stage === 2) currentStage = 2;
    else if (stage === 3) currentStage = 3;
    else if (stage === '4a' || stage === '4b') currentStage = 4;
    else if (stage === '5a') currentStage = 5;
    else if (stage === 6) currentStage = 6;
    else if (stage === 7) currentStage = 7;
    
    currentRecord.rtv_data.current_stage = currentStage;
    saveRTVData();
    renderAllStages();
    
    if (stage === 7) {
        setTimeout(() => alert('ğŸ‰ æµç¨‹å·²å®Œæˆï¼'), 500);
    }
};

window.selectRoute = function(route) {
    if (currentStage >= 3) return;
    
    // è·¯ç·šé¸æ“‡éšæ®µï¼šæ¨™è¨˜ç‚ºå®Œæˆï¼Œä½†ä¸è¨˜éŒ„å®Œæˆæ™‚é–“
    selectedRoute = route;
    currentRecord.rtv_data.selected_route = route;
    
    const stageKey = 'stage3';
    currentRecord.rtv_data.stage_completion[stageKey] = true;
    // ä¸è¨˜éŒ„ completion_dates[stageKey]
    
    currentStage = 3;
    currentRecord.rtv_data.current_stage = currentStage;
    
    saveRTVData();
    renderAllStages();
};

window.saveRTVData = function() {
    const storedRecords = localStorage.getItem('iqcRecords');
    const records = JSON.parse(storedRecords);
    const index = records.findIndex(r => r.id === parseInt(recordId));
    if (index > -1) {
        records[index] = currentRecord;
        localStorage.setItem('iqcRecords', JSON.stringify(records));
        alert('âœ… æ›´æ”¹å·²ä¿å­˜ï¼');
    }
};

window.resetProcess = function() {
    if (!confirm('ç¢ºå®šè¦é‡ç½®æ•´å€‹æµç¨‹å—ï¼Ÿ')) return;
    currentRecord.rtv_data = {
        current_stage: 0,
        selected_route: null,
        tracking_number: '',
        stage_completion: {},
        completion_dates: {}
    };
    currentStage = 0;
    selectedRoute = null;
    saveRTVData();
    renderAllStages();
};
JSEOF

# æ›¿æ› JS æ–‡ä»¶
mv rtv-detail-no-route-time.js rtv-detail.js

# æäº¤æ¨é€
git add rtv-detail.js
git commit -m "Route selection stage: no completion time recording or display

Changes:
- selectRoute() marks stage 3 as complete but does NOT save completion_dates
- Route selection stage never displays completion time badge
- Added condition: completionDate && !stage.isRoute in rendering
- Route selection is purely a branching decision, not a timed event
- All other stages continue to record and display completion times"

git push origin main

echo ""
echo "âœ… è·¯ç·šé¸æ“‡éšæ®µä¸å†è¨˜éŒ„æ™‚é–“ï¼"
echo ""
echo "æ”¹é€²ï¼š"
echo "- ğŸ›£ï¸ é¸æ“‡é‹é€æ–¹å¼æ™‚ä¸è¨˜éŒ„å®Œæˆæ™‚é–“"
echo "- ğŸ‘ï¸ è·¯ç·šé¸æ“‡éšæ®µä¸é¡¯ç¤ºå®Œæˆæ™‚é–“æ¨™ç±¤"
echo "- âœ… éšæ®µä»æœƒæ¨™è¨˜ç‚ºå·²å®Œæˆï¼ˆç”¨æ–¼é€²åº¦è¿½è¹¤ï¼‰"
echo "- â° å…¶ä»–æ‰€æœ‰éšæ®µæ­£å¸¸è¨˜éŒ„å’Œé¡¯ç¤ºå®Œæˆæ™‚é–“"
echo ""
echo "ğŸŒ https://s911986.github.io/iqc-tracking-system/"
cd ~/Desktop/iqc-tracking-system

# é¦–å…ˆï¼Œè®“æˆ‘å€‘æŸ¥çœ‹ä¸»é é¢çš„èªè¨€åˆ‡æ›æ˜¯å¦‚ä½•å¯¦ç¾çš„
cat > rtv-detail-i18n.js << 'JSEOF'
let currentRecord = null;
let recordId = null;
let currentStage = 0;
let selectedRoute = null;
let currentLanguage = 'zh'; // é»˜èªä¸­æ–‡

// å¤šèªè¨€ç¿»è­¯
const translations = {
    zh: {
        // Header
        backButton: 'è¿”å›',
        pageTitle: 'RTV æµç¨‹è¿½è¹¤',
        
        // Basic Info
        qpnLabel: 'æ–™è™Ÿ QPN',
        snLabel: 'SN',
        deptLabel: 'éƒ¨é–€',
        
        // Progress
        processLabel: 'æµç¨‹',
        progressLabel: 'é€²åº¦',
        
        // Stages
        kickOff: 'Kick Off',
        departed: 'å·²é›¢å» ',
        selectRoute: 'é¸æ“‡é‹é€æ–¹å¼',
        express: 'å¿«é',
        returnShip: 'é€€é‹',
        trackingNumber: 'å¿«éå–®è™Ÿ',
        arrivedVendor: 'å·²æŠµé”å» å•†ç«¯',
        faInProgress: 'FAé€²è¡Œä¸­',
        faCompleted: 'FAå·²å®Œæˆ',
        
        // Status
        completed: 'å·²å®Œæˆ',
        inProgress: 'é€²è¡Œä¸­',
        pending: 'å¾…è™•ç†',
        
        // Actions
        completeStage: 'å®Œæˆæ­¤éšæ®µ',
        resetProcess: 'é‡ç½®æµç¨‹',
        saveChanges: 'ä¿å­˜æ›´æ”¹',
        
        // Labels
        completionTime: 'å®Œæˆæ™‚é–“',
        trackingNumberLabel: 'å¿«éå–®è™Ÿ',
        enterTrackingNumber: 'è¼¸å…¥å¿«éå–®è™Ÿ',
        trackingNumberDisplay: 'å¿«éå–®è™Ÿ',
        
        // Alerts
        noRecordId: 'éŒ¯èª¤ï¼šæœªæŒ‡å®šè¨˜éŒ„ IDï¼',
        selectRouteFirst: 'âš ï¸ è«‹å…ˆé¸æ“‡é‹é€æ–¹å¼ï¼',
        noTimeInput: 'âš ï¸ æ‰¾ä¸åˆ°å®Œæˆæ™‚é–“è¼¸å…¥æ¡†ï¼',
        selectTime: 'âš ï¸ è«‹é¸æ“‡å®Œæˆæ™‚é–“ï¼',
        enterTracking: 'âš ï¸ è«‹è¼¸å…¥å¿«éå–®è™Ÿï¼',
        changesSaved: 'âœ… æ›´æ”¹å·²ä¿å­˜ï¼',
        processComplete: 'ğŸ‰ æµç¨‹å·²å®Œæˆï¼',
        confirmReset: 'ç¢ºå®šè¦é‡ç½®æ•´å€‹æµç¨‹å—ï¼Ÿ'
    },
    en: {
        // Header
        backButton: 'Back',
        pageTitle: 'RTV Process Tracking',
        
        // Basic Info
        qpnLabel: 'QPN',
        snLabel: 'SN',
        deptLabel: 'Department',
        
        // Progress
        processLabel: 'Process',
        progressLabel: 'Progress',
        
        // Stages
        kickOff: 'Kick Off',
        departed: 'Departed',
        selectRoute: 'Select Shipping Method',
        express: 'Express',
        returnShip: 'Return',
        trackingNumber: 'Tracking Number',
        arrivedVendor: 'Arrived at Vendor',
        faInProgress: 'FA In Progress',
        faCompleted: 'FA Completed',
        
        // Status
        completed: 'Completed',
        inProgress: 'In Progress',
        pending: 'Pending',
        
        // Actions
        completeStage: 'Complete This Stage',
        resetProcess: 'Reset Process',
        saveChanges: 'Save Changes',
        
        // Labels
        completionTime: 'Completion Time',
        trackingNumberLabel: 'Tracking Number',
        enterTrackingNumber: 'Enter Tracking Number',
        trackingNumberDisplay: 'Tracking No.',
        
        // Alerts
        noRecordId: 'Error: No record ID specified!',
        selectRouteFirst: 'âš ï¸ Please select shipping method first!',
        noTimeInput: 'âš ï¸ Completion time input not found!',
        selectTime: 'âš ï¸ Please select completion time!',
        enterTracking: 'âš ï¸ Please enter tracking number!',
        changesSaved: 'âœ… Changes saved!',
        processComplete: 'ğŸ‰ Process completed!',
        confirmReset: 'Are you sure you want to reset the entire process?'
    },
    vi: {
        // Header
        backButton: 'Quay láº¡i',
        pageTitle: 'Theo dÃµi quy trÃ¬nh RTV',
        
        // Basic Info
        qpnLabel: 'MÃ£ QPN',
        snLabel: 'SN',
        deptLabel: 'PhÃ²ng ban',
        
        // Progress
        processLabel: 'Quy trÃ¬nh',
        progressLabel: 'Tiáº¿n Ä‘á»™',
        
        // Stages
        kickOff: 'Báº¯t Ä‘áº§u',
        departed: 'ÄÃ£ xuáº¥t xÆ°á»Ÿng',
        selectRoute: 'Chá»n phÆ°Æ¡ng thá»©c váº­n chuyá»ƒn',
        express: 'Chuyá»ƒn phÃ¡t nhanh',
        returnShip: 'Tráº£ hÃ ng',
        trackingNumber: 'MÃ£ váº­n Ä‘Æ¡n',
        arrivedVendor: 'ÄÃ£ Ä‘áº¿n nhÃ  cung cáº¥p',
        faInProgress: 'FA Ä‘ang tiáº¿n hÃ nh',
        faCompleted: 'FA hoÃ n thÃ nh',
        
        // Status
        completed: 'HoÃ n thÃ nh',
        inProgress: 'Äang xá»­ lÃ½',
        pending: 'Chá» xá»­ lÃ½',
        
        // Actions
        completeStage: 'HoÃ n thÃ nh giai Ä‘oáº¡n nÃ y',
        resetProcess: 'Äáº·t láº¡i quy trÃ¬nh',
        saveChanges: 'LÆ°u thay Ä‘á»•i',
        
        // Labels
        completionTime: 'Thá»i gian hoÃ n thÃ nh',
        trackingNumberLabel: 'MÃ£ váº­n Ä‘Æ¡n',
        enterTrackingNumber: 'Nháº­p mÃ£ váº­n Ä‘Æ¡n',
        trackingNumberDisplay: 'MÃ£ váº­n Ä‘Æ¡n',
        
        // Alerts
        noRecordId: 'Lá»—i: KhÃ´ng cÃ³ ID báº£n ghi!',
        selectRouteFirst: 'âš ï¸ Vui lÃ²ng chá»n phÆ°Æ¡ng thá»©c váº­n chuyá»ƒn trÆ°á»›c!',
        noTimeInput: 'âš ï¸ KhÃ´ng tÃ¬m tháº¥y Ã´ nháº­p thá»i gian hoÃ n thÃ nh!',
        selectTime: 'âš ï¸ Vui lÃ²ng chá»n thá»i gian hoÃ n thÃ nh!',
        enterTracking: 'âš ï¸ Vui lÃ²ng nháº­p mÃ£ váº­n Ä‘Æ¡n!',
        changesSaved: 'âœ… ÄÃ£ lÆ°u thay Ä‘á»•i!',
        processComplete: 'ğŸ‰ Quy trÃ¬nh Ä‘Ã£ hoÃ n thÃ nh!',
        confirmReset: 'Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘áº·t láº¡i toÃ n bá»™ quy trÃ¬nh khÃ´ng?'
    }
};

const stages = {
    1: { icon: 'rocket', titleKey: 'kickOff' },
    2: { icon: 'package-open', titleKey: 'departed' },
    3: { icon: 'git-branch', titleKey: 'selectRoute', titleExpressKey: 'express', titleReturnKey: 'returnShip', isRoute: true },
    '4a': { icon: 'truck', titleKey: 'trackingNumber', needsInput: true, route: 'express' },
    '5a': { icon: 'map-pin', titleKey: 'arrivedVendor', route: 'express' },
    '4b': { icon: 'map-pin', titleKey: 'arrivedVendor', route: 'return' },
    6: { icon: 'microscope', titleKey: 'faInProgress' },
    7: { icon: 'check-circle', titleKey: 'faCompleted' }
};

function t(key) {
    return translations[currentLanguage][key] || key;
}

function formatDateTime(isoString) {
    const date = new Date(isoString);
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    const h = String(date.getHours()).padStart(2, '0');
    const min = String(date.getMinutes()).padStart(2, '0');
    const s = String(date.getSeconds()).padStart(2, '0');
    return `${y}-${m}-${d} ${h}:${min}:${s}`;
}

function formatDateTimeForInput(isoString) {
    const date = new Date(isoString);
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    const h = String(date.getHours()).padStart(2, '0');
    const min = String(date.getMinutes()).padStart(2, '0');
    return `${y}-${m}-${d}T${h}:${min}`;
}

function getCurrentDateTime() {
    return formatDateTimeForInput(new Date().toISOString());
}

function initLanguage() {
    // å¾ localStorage ç²å–èªè¨€è¨­ç½®
    const savedLanguage = localStorage.getItem('language');
    if (savedLanguage && translations[savedLanguage]) {
        currentLanguage = savedLanguage;
    }
}

function updateUILanguage() {
    // æ›´æ–°é é¢æ¨™é¡Œ
    document.getElementById('page-title').textContent = t('pageTitle');
    document.getElementById('back-button-text').textContent = t('backButton');
    
    // æ›´æ–°åŸºæœ¬ä¿¡æ¯æ¨™ç±¤
    document.getElementById('qpn-label').textContent = t('qpnLabel');
    document.getElementById('sn-label').textContent = t('snLabel');
    document.getElementById('dept-label').textContent = t('deptLabel');
    
    // æ›´æ–°é€²åº¦æ¨™ç±¤
    document.getElementById('process-label').textContent = t('processLabel');
    document.getElementById('progress-label').textContent = t('progressLabel');
    
    // æ›´æ–°åº•éƒ¨æŒ‰éˆ•
    document.getElementById('reset-button').textContent = t('resetProcess');
    document.getElementById('save-button').textContent = t('saveChanges');
}

document.addEventListener('DOMContentLoaded', () => {
    initLanguage();
    
    const urlParams = new URLSearchParams(window.location.search);
    recordId = urlParams.get('id');
    if (!recordId) {
        alert(t('noRecordId'));
        window.location.href = 'index.html';
        return;
    }
    
    loadRecord();
    updateUILanguage();
    renderAllStages();
    lucide.createIcons();
});

function loadRecord() {
    const storedRecords = localStorage.getItem('iqcRecords');
    if (!storedRecords) {
        window.location.href = 'index.html';
        return;
    }
    const records = JSON.parse(storedRecords);
    currentRecord = records.find(r => r.id === parseInt(recordId));
    if (!currentRecord) {
        window.location.href = 'index.html';
        return;
    }
    if (!currentRecord.rtv_data) {
        currentRecord.rtv_data = {
            current_stage: 0,
            selected_route: null,
            tracking_number: '',
            stage_completion: {},
            completion_dates: {}
        };
    }
    currentStage = currentRecord.rtv_data.current_stage || 0;
    selectedRoute = currentRecord.rtv_data.selected_route || null;
    
    document.getElementById('display-qpn').textContent = currentRecord.qpn || '-';
    document.getElementById('display-sn').textContent = currentRecord.sn || '-';
    document.getElementById('display-dept').textContent = currentRecord.dept || '-';
}

function renderAllStages() {
    const container = document.getElementById('timeline-container');
    const line = container.querySelector('.connecting-line');
    container.innerHTML = '';
    if (line) container.appendChild(line);
    
    let allStages = [1, 2, 3];
    
    if (selectedRoute === 'express') {
        allStages = [1, 2, 3, '4a', '5a', 6, 7];
    } else if (selectedRoute === 'return') {
        allStages = [1, 2, 3, '4b', 6, 7];
    } else {
        allStages = [1, 2, 3, '4a', '5a', 6, 7];
    }
    
    allStages.forEach(stageId => {
        if (selectedRoute) {
            const stage = stages[stageId];
            if (stage.route && stage.route !== selectedRoute) {
                return;
            }
        }
        
        const stageNode = createStageElement(stageId);
        container.appendChild(stageNode);
    });
    
    updateProgress();
    lucide.createIcons();
}

function createStageElement(stageId) {
    const stage = stages[stageId];
    const stageKey = 'stage' + stageId;
    const isCompleted = currentRecord.rtv_data.stage_completion[stageKey];
    const isActive = shouldBeActive(stageId);
    const completionDate = currentRecord.rtv_data.completion_dates[stageKey];
    
    let statusClass = 'pending';
    if (isCompleted) {
        statusClass = 'completed';
    } else if (isActive) {
        statusClass = 'active';
    }
    
    if (!selectedRoute && stage.route) {
        const div = document.createElement('div');
        div.className = 'stage-node pending';
        div.innerHTML = `
            <div class="stage-header">
                <i data-lucide="${stage.icon}" class="stage-icon"></i>
                <span class="stage-title">${t(stage.titleKey)}</span>
            </div>
            <div class="stage-dot dot-pending"></div>
            <span class="status-badge badge-pending">${t('pending')}</span>
        `;
        return div;
    }
    
    const stageDiv = document.createElement('div');
    stageDiv.className = `stage-node ${statusClass}`;
    
    let html = '';
    
    // å®Œæˆæ™‚é–“
    if (completionDate && !stage.isRoute) {
        html += `
            <div class="completion-time">
                <i data-lucide="clock"></i>
                <span>${t('completionTime')}</span>
                <span class="time-value">${formatDateTime(completionDate)}</span>
            </div>
        `;
    }
    
    // éšæ®µæ¨™é¡Œ
    let displayTitle = t(stage.titleKey);
    if (stageId === 3 && selectedRoute) {
        displayTitle = selectedRoute === 'express' ? t(stage.titleExpressKey) : t(stage.titleReturnKey);
    }
    
    html += `
        <div class="stage-header">
            <i data-lucide="${stage.icon}" class="stage-icon"></i>
            <span class="stage-title">${displayTitle}</span>
        </div>
    `;
    
    // åœ“é»
    html += `
        <div class="stage-dot ${isCompleted ? 'dot-completed' : isActive ? 'dot-active' : 'dot-pending'}"></div>
    `;
    
    // ç‹€æ…‹æ¨™ç±¤
    const statusText = isCompleted ? t('completed') : isActive ? t('inProgress') : t('pending');
    html += `
        <span class="status-badge ${isCompleted ? 'badge-completed' : isActive ? 'badge-active' : 'badge-pending'}">
            ${statusText}
        </span>
    `;
    
    // å‹•ä½œå€åŸŸ
    html += '<div class="action-area">';
    
    // é¡¯ç¤ºå¿«éå–®è™Ÿ
    if (stageId === '4a' && isCompleted && currentRecord.rtv_data.tracking_number) {
        html += `
            <div class="tracking-display">
                ${t('trackingNumberDisplay')}: ${currentRecord.rtv_data.tracking_number}
            </div>
        `;
    }
    
    // è·¯ç·šé¸æ“‡
    if (stage.isRoute && !selectedRoute && isActive) {
        html += `
            <div class="route-selection">
                <button class="route-option" onclick="selectRoute('express')">
                    <i data-lucide="truck" style="color: #6366f1;"></i>
                    <span>${t('express')}</span>
                </button>
                <button class="route-option" onclick="selectRoute('return')">
                    <i data-lucide="package-x" style="color: #f97316;"></i>
                    <span>${t('returnShip')}</span>
                </button>
            </div>
        `;
    }
    
    // æ™®é€šéšæ®µï¼šé¡¯ç¤ºå®Œæˆæ™‚é–“è¼¸å…¥æ¡†å’Œå…¶ä»–è¼¸å…¥
    if (isActive && !stage.isRoute && !isCompleted) {
        // å®Œæˆæ™‚é–“è¼¸å…¥æ¡†
        html += `
            <div style="margin-bottom: 0.75rem;">
                <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">
                    ${t('completionTime')}
                </label>
                <input type="datetime-local" id="completion-time-${stageId}" class="tracking-input" 
                       value="${getCurrentDateTime()}" 
                       style="width: 260px;">
            </div>
        `;
        
        // å¿«éå–®è™Ÿè¼¸å…¥æ¡†
        if (stage.needsInput) {
            html += `
                <div style="margin-bottom: 0.75rem;">
                    <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">
                        ${t('trackingNumberLabel')}
                    </label>
                    <input type="text" id="tracking-number" class="tracking-input" 
                           placeholder="${t('enterTrackingNumber')}" 
                           value="${currentRecord.rtv_data.tracking_number || ''}"
                           style="width: 260px;">
                </div>
            `;
        }
        
        // å®ŒæˆæŒ‰éˆ•
        html += `
            <button class="complete-button" onclick="completeStage(${typeof stageId === 'string' ? "'" + stageId + "'" : stageId})">
                ${t('completeStage')}
            </button>
        `;
    }
    
    html += '</div>';
    
    stageDiv.innerHTML = html;
    return stageDiv;
}

function shouldBeActive(stageId) {
    const stageKey = 'stage' + stageId;
    if (currentRecord.rtv_data.stage_completion[stageKey]) return false;
    
    if (typeof stageId === 'number' && currentStage === stageId - 1) return true;
    if (stageId === 3 && currentStage === 2) return true;
    if (stageId === '4a' && currentStage === 3 && selectedRoute === 'express') return true;
    if (stageId === '4b' && currentStage === 3 && selectedRoute === 'return') return true;
    if (stageId === '5a' && currentStage === 4 && selectedRoute === 'express') return true;
    if (stageId === 6) {
        if (selectedRoute === 'express' && currentStage === 5) return true;
        if (selectedRoute === 'return' && currentStage === 4) return true;
    }
    if (stageId === 7 && currentStage === 6) return true;
    
    return false;
}

function updateProgress() {
    const completion = currentRecord.rtv_data.stage_completion;
    let total = selectedRoute === 'express' ? 7 : selectedRoute === 'return' ? 6 : 3;
    const completed = Object.values(completion).filter(v => v).length;
    const percent = Math.round((completed / total) * 100);
    
    document.getElementById('progress-percentage').textContent = percent + '%';
    document.getElementById('progress-line').style.width = percent + '%';
}

window.completeStage = function(stage) {
    const stageInfo = stages[stage];
    
    if (stageInfo.isRoute && !selectedRoute) {
        alert(t('selectRouteFirst'));
        return;
    }
    
    const completionTimeInput = document.getElementById('completion-time-' + stage);
    if (!completionTimeInput) {
        alert(t('noTimeInput'));
        return;
    }
    
    const completionTimeValue = completionTimeInput.value;
    if (!completionTimeValue) {
        alert(t('selectTime'));
        return;
    }
    
    const completionDate = new Date(completionTimeValue).toISOString();
    
    if (stage === '4a') {
        const trackingNumber = document.getElementById('tracking-number').value.trim();
        if (!trackingNumber) {
            alert(t('enterTracking'));
            return;
        }
        currentRecord.rtv_data.tracking_number = trackingNumber;
    }
    
    const stageKey = 'stage' + stage;
    currentRecord.rtv_data.stage_completion[stageKey] = true;
    currentRecord.rtv_data.completion_dates[stageKey] = completionDate;
    
    if (stage === 1) currentStage = 1;
    else if (stage === 2) currentStage = 2;
    else if (stage === 3) currentStage = 3;
    else if (stage === '4a' || stage === '4b') currentStage = 4;
    else if (stage === '5a') currentStage = 5;
    else if (stage === 6) currentStage = 6;
    else if (stage === 7) currentStage = 7;
    
    currentRecord.rtv_data.current_stage = currentStage;
    saveRTVData();
    renderAllStages();
    
    if (stage === 7) {
        setTimeout(() => alert(t('processComplete')), 500);
    }
};

window.selectRoute = function(route) {
    if (currentStage >= 3) return;
    
    selectedRoute = route;
    currentRecord.rtv_data.selected_route = route;
    
    const stageKey = 'stage3';
    currentRecord.rtv_data.stage_completion[stageKey] = true;
    
    currentStage = 3;
    currentRecord.rtv_data.current_stage = currentStage;
    
    saveRTVData();
    renderAllStages();
};

window.saveRTVData = function() {
    const storedRecords = localStorage.getItem('iqcRecords');
    const records = JSON.parse(storedRecords);
    const index = records.findIndex(r => r.id === parseInt(recordId));
    if (index > -1) {
        records[index] = currentRecord;
        localStorage.setItem('iqcRecords', JSON.stringify(records));
        alert(t('changesSaved'));
    }
};

window.resetProcess = function() {
    if (!confirm(t('confirmReset'))) return;
    currentRecord.rtv_data = {
        current_stage: 0,
        selected_route: null,
        tracking_number: '',
        stage_completion: {},
        completion_dates: {}
    };
    currentStage = 0;
    selectedRoute = null;
    saveRTVData();
    renderAllStages();
};
JSEOF

# æ›´æ–° HTML æ·»åŠ èªè¨€æ¨™è­˜
cat > rtv-detail-i18n.html << 'HTMLEOF'
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTV æµç¨‹è¿½è¹¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .timeline-section {
            background: white;
            border-radius: 1rem;
            padding: 13rem 4rem 8rem;
            margin: 2rem 0;
            min-height: 900px;
        }
        
        .timeline-wrapper {
            position: relative;
            padding: 13rem 0 12rem;
        }
        
        .timeline-container {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 6rem;
        }
        
        /* é€£æ¥ç·š */
        .connecting-line {
            position: absolute;
            top: 50%;
            left: 3%;
            right: 3%;
            height: 6px;
            background: #e5e7eb;
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .progress-line {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 50%, #8b5cf6 100%);
            transition: width 0.5s ease;
            border-radius: 999px;
        }
        
        /* éšæ®µç¯€é» */
        .stage-node {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
            z-index: 10;
        }
        
        /* å®Œæˆæ™‚é–“ */
        .completion-time {
            position: absolute;
            top: -140px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.875rem;
            background: white;
            border: 1.5px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.688rem;
            color: #6b7280;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        
        .completion-time i {
            width: 12px;
            height: 12px;
        }
        
        .time-value {
            font-family: 'SF Mono', monospace;
            color: #1f2937;
            font-weight: 500;
            font-size: 0.688rem;
        }
        
        /* éšæ®µæ¨™é¡Œ */
        .stage-header {
            position: absolute;
            top: -75px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            white-space: nowrap;
        }
        
        .stage-icon {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
            transition: color 0.3s;
        }
        
        .stage-title {
            font-size: 1.25rem;
            font-weight: 700;
            transition: color 0.3s;
        }
        
        /* å·²å®Œæˆæˆ–é€²è¡Œä¸­çš„æ¨£å¼ï¼ˆé»‘è‰²ï¼‰ */
        .stage-node.completed .stage-icon,
        .stage-node.active .stage-icon {
            color: #6366f1;
        }
        
        .stage-node.completed .stage-title,
        .stage-node.active .stage-title {
            color: #1f2937;
        }
        
        /* å¾…è™•ç†çš„æ¨£å¼ï¼ˆç°è‰²ï¼‰ */
        .stage-node.pending .stage-icon {
            color: #9ca3af;
        }
        
        .stage-node.pending .stage-title {
            color: #9ca3af;
        }
        
        /* åœ“é» */
        .stage-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        
        .dot-completed {
            background: #3b82f6;
        }
        
        .dot-active {
            background: #10b981;
            width: 33px;
            height: 33px;
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .dot-pending {
            background: #d1d5db;
        }
        
        @keyframes pulse-ring {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
            }
            50% {
                box-shadow: 0 0 0 16px rgba(16, 185, 129, 0);
            }
        }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.625rem 1.5rem;
            border-radius: 9999px;
            font-size: 1rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .badge-completed {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-pending {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        /* å‹•ä½œå€åŸŸ */
        .action-area {
            position: absolute;
            top: 130px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.875rem;
        }
        
        .complete-button {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.35);
            white-space: nowrap;
        }
        
        .complete-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
        }
        
        /* è·¯ç·šé¸æ“‡ */
        .route-selection {
            display: flex;
            gap: 1.25rem;
        }
        
        .route-option {
            padding: 1.5rem 2rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.875rem;
            background: white;
        }
        
        .route-option:hover {
            border-color: #6366f1;
            background: #f5f3ff;
            transform: translateY(-3px);
        }
        
        .route-option i {
            width: 40px;
            height: 40px;
        }
        
        .route-option span {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        /* è¼¸å…¥æ¡† */
        .tracking-input {
            width: 260px;
            padding: 0.875rem 1.25rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
        }
        
        .tracking-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        /* å¿«éå–®è™Ÿé¡¯ç¤º */
        .tracking-display {
            padding: 0.75rem 1.25rem;
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 0.75rem;
            font-size: 1rem;
            color: #166534;
            font-family: 'SF Mono', monospace;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="max-w-[2000px] mx-auto p-8">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-8 bg-gradient-to-r from-indigo-500 to-purple-600 p-8 rounded-2xl shadow-lg text-white">
            <button onclick="window.location.href='index.html'" class="flex items-center gap-3 px-6 py-3 bg-white/20 hover:bg-white/30 rounded-xl transition text-lg">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
                <span id="back-button-text">è¿”å›</span>
            </button>
            <h1 id="page-title" class="text-3xl font-bold">RTV æµç¨‹è¿½è¹¤</h1>
            <div class="w-32"></div>
        </header>

        <!-- Basic Info -->
        <div class="bg-white p-8 rounded-2xl shadow-sm mb-8">
            <div class="grid grid-cols-3 gap-6">
                <div class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
                    <div id="qpn-label" class="text-sm text-gray-600 mb-2 font-medium">æ–™è™Ÿ QPN</div>
                    <div class="text-xl font-bold text-gray-900" id="display-qpn">-</div>
                </div>
                <div class="p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
                    <div id="sn-label" class="text-sm text-gray-600 mb-2 font-medium">SN</div>
                    <div class="text-xl font-bold text-gray-900" id="display-sn">-</div>
                </div>
                <div class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
                    <div id="dept-label" class="text-sm text-gray-600 mb-2 font-medium">éƒ¨é–€</div>
                    <div class="text-xl font-bold text-gray-900" id="display-dept">-</div>
                </div>
            </div>
        </div>

        <!-- Progress Header -->
        <div class="bg-white p-6 rounded-2xl shadow-sm mb-8 flex justify-between items-center">
            <div id="process-label" class="text-2xl font-bold text-gray-900">æµç¨‹</div>
            <div class="text-2xl font-bold text-gray-700"><span id="progress-label">é€²åº¦</span>ï¼š<span id="progress-percentage" class="text-indigo-600">0%</span></div>
        </div>

        <!-- Timeline -->
        <div class="timeline-section shadow-sm">
            <div class="timeline-wrapper">
                <div class="timeline-container" id="timeline-container">
                    <div class="connecting-line">
                        <div class="progress-line" id="progress-line" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="flex justify-end gap-4 mt-8">
            <button id="reset-button" onclick="resetProcess()" class="px-8 py-4 text-lg font-medium text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 rounded-xl transition shadow-sm">
                é‡ç½®æµç¨‹
            </button>
            <button id="save-button" onclick="saveRTVData()" class="px-8 py-4 text-lg font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-xl transition shadow-md">
                ä¿å­˜æ›´æ”¹
            </button>
        </div>
    </div>

    <script src="rtv-detail.js"></script>
</body>
</html>
